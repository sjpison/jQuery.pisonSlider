/**
 * pisonSlider
 *
 * jQuery Gallery plugin
 * @version 0.2.6
 *
 * copyright (c) 2008 Pison, Seol Dong-jin <www.codemission.org>
 * It need jQuery 1.8+
 */
Array.prototype.indexOf||(Array.prototype.indexOf=function(i){var t=this.length>>>0,e=Number(arguments[1])||0;for(e=e<0?Math.ceil(e):Math.floor(e),e<0&&(e+=t);e<t;e++)if(e in this&&this[e]===i)return e;return-1}),function(i){i.fn.extend({pisonSlider:function(t){if(!this.is("ul")&&!this.is("ol")||0==this.find("li").length)return!1;this.addClass("pisonSlider-list");var e={startSlideIndex:0,mode:"widthfit",zoominMouseOverStop:!0,thumbPosition:"none",useThumbPage:!0,numThumbs:7,useThumbSize:!1,thumbWidth:75,thumbHeight:75,width:0,height:440,autoSlide:!1,autoSlideTimer:5e3,autoSlideBar:!0,autoSlideBarPosition:"bottom",onHoverStop:!0,indicator:!1,effect:"random",duration:400,hDuration:0,boxEffectDurationFactor:2,thumbSlideEvent:"click",SlideLoaded:null,beforeSlideChange:null,clickAction:"link_blank"};i.extend(e,t),this.find("li").each(function(){var t=i(this).find("img");"undefined"==typeof i(this).data("origin")&&i(this).data("origin",t.attr("src")),"undefined"==typeof i(this).data("thumb")&&"undefined"==typeof t.data("thumb")||t.removeAttr("src")});var n=null!=navigator.userAgent.match(/MSIE/i),a=n&&navigator.userAgent.match(/MSIE (\d)/i)[1]<9&&navigator.userAgent.match(/MSIE (\d)/i)[1]>4;a&&"zoomin"==e.mode&&(e.mode="filled"),this.find("li").length<=1&&(e.autoSlide=!1,e.indicator=!1);var h=this.wrap('<div class="pisonSlider'+(a?" underIE8":"")+(n?" isIE":"")+'"><div class="pisonSlider-thumbs pisonSlider-thumbs-'+e.thumbPosition+(e.useThumbPage?"":" pisonSlider-thumbs-nopage")+'" /></div>').parent().parent(),d=h.find("div.pisonSlider-thumbs"),o=this,s=i('<div class="pisonSlider-canvas pisonSlider-thumbs-'+e.thumbPosition+'"><div class="pisonSlider-canvas-clickarea"></div></div>'),r={},l=null,c=null,f=!1;0==h.width||"left"!=e.thumbPosition&&"right"!=e.thumbPosition||d.width(h.width()-e.width),"left"==e.thumbPosition||"bottom"==e.thumbPosition||"right"==e.thumbPosition?h.prepend(s):h.append(s);var u=i('<div class="pagearrow thumbs_left_arrow"></div>');d.prepend(u);var g=i('<div class="pagearrow thumbs_right_arrow"></div>');d.append(g);var m={};h.f_width=h.width,h.f_height=h.height,i.extend(h,e),r.effect_box=["box1","box2","box3"],r.effect_normal=["fade","coverLeft","coverRight"],r.effect_list=r.effect_box.concat(r.effect_normal),i.extend(h,{nowPage:0,nowSlide:0,totalSlideCnt:o.find("li").length,prevSlide:function(){this.nowSlide-1<0?this.slideChange(this.totalSlideCnt-1):this.slideChange(this.nowSlide-1)},nextSlide:function(){h.find("li").length<=1||this.slideChange(this.nowSlide+1)},pageChange:function(t,e){"undefined"==typeof e?e=!0:"";var n=this.numThumbs*t,a=this.numThumbs*(t+1)-1,d=!1;o.find("li").each(function(t,e){t>=n&&t<=a?i(this).removeClass("unvisible"):(h.useThumbPage&&i(this).addClass("unvisible"),i(this).is("li.current")&&(d=!0))}),d&&e&&this.slideChange(n),this.nowPage=t,h.useThumbPage?(0==this.nowPage?u.hide():u.show(),a>=o.find("li").length-1?g.hide():g.show()):(u.hide(),g.hide())},NowSlideTransitioningCount:0,SlideTransition:function(t,n){var d=++h.NowSlideTransitioningCount,o=this.effect;"random"==this.effect?o=r.effect_list[Math.floor(Math.random()*r.effect_list.length)]:"box_random"==this.effect?o=r.effect_box[Math.floor(Math.random()*r.effect_box.length)]:"normal_random"==this.effect&&(o=r.effect_normal[Math.floor(Math.random()*r.effect_normal.length)]);var u=i(m[t]),g=(m[t],s.find("div.pisonSlider_img_wrap:last").stop(!0,!0).addClass("pisonSlider_preimg_wrap")),v=g.find("img"),w=i('<div class="pisonSlider_img_wrap" data-transition_effect="'+o+'" />').appendTo(s),S=u[0].cssPosition(),b=new Array,x="100",y="100",_=1,C=1;if(r.effect_box.indexOf(o)>=0){var P=e.width>0?e.width:s.width(),M=S.height;_=Math.round(P/70),C=Math.round(M/70),x/=_,y/=C}if("zoomin"==h.mode){for(var k="",T=0;T<C;T++)for(var I=0;I<_;I++)k+='<canvas class="pisonSlider_imgbox" data-x="'+I+'" data-y="'+T+'" width="'+x+'%" height="'+y+'%" style="width:'+x+"%;height:"+y+"%;left:"+x*I+"%;top:"+y*T+'%;" />';w.append(k).find("canvas").each(function(t){b[t]={ctx:this.getContext("2d"),x:i(this).data("x"),y:i(this).data("y")},b[t].ctx.drawImage(u[0],S.left-x*b[t].x,S.top-y*b[t].y,S.width,S.height)})}else{for(var k="",T=0;T<C;T++)for(var I=0;I<_;I++)k+='<div class="pisonSlider_imgbox" style="width:'+x+"%;height:"+y+"%;left:"+x*I+"%;top:"+y*T+"%;",k+=a?'"><img src="'+u.attr("src")+'" style="width:'+S.width+"px;height:"+S.height+"px;margin-top:"+(y*T*-1+S.top)+"px;margin-left:"+(x*I*-1+S.left)+'px;" /></div>':'"><div style="background-image:url(\''+u.attr("src")+"');width:"+100*_+"%;height:"+100*C+"%;left:-"+I+"00%;top:-"+T+'00%;" /></div>';w.append(k)}if(p&&s.height()!=S.height){var E=S.height>v.height()?S.height:v.height();!h.hDuration||u.is(".pisonSlider_preimg")?s.height(E):h.hDuration&&s.animate({height:E},h.hDuration)}var B=function(){g.remove(),d==h.NowSlideTransitioningCount&&(s.find(".pisonSlider_preimg_wrap").remove(),p&&s.height()!=S.height&&(h.hDuration?s.animate({height:S.height},h.hDuration):s.height(S.height)),clearInterval(c),i.isFunction(n)&&(h.SlideTransitionCallback=n,h.SlideTransitionCallback(t)))};if("zoomin"==h.mode){clearInterval(c),c=l;var z=1.0005,A=S.width,D=S.height;l=setInterval(function(){if(!f){for(var i in b)b[i].ctx.drawImage(u[0],S.left-(A-S.width)/2-x*b[i].x,S.top-(D-S.height)/2-y*b[i].y,A,D);A*=z,D*=z,A>1.3*S.width&&clearInterval(l)}},40)}if(w.data("effect_type",o),"fade"==o)w.css("opacity",1).find(".pisonSlider_imgbox").css("opacity",0).animate({opacity:1},h.duration,function(){0==g.length&&B()}),g.find(".pisonSlider_imgbox").delay(h.duration/2).animate({opacity:0},h.duration/2,function(){B()});else if("coverLeft"==o||"coverRight"==o){var H=e.width>0?e.width:s.width();e.height>0?e.height:u[0].height;w.css({left:"coverLeft"==h.effect?s.width():-H,top:0,opacity:1,"z-index":2}).animate({left:0},h.duration,function(){0==g.length&&B()}),g.delay(h.duration/2).animate({opacity:0},h.duration/2,function(){B()})}else if("box1"==o){var q=h.duration*h.boxEffectDurationFactor,N=w.find(".pisonSlider_imgbox").css("opacity",0);w.css("opacity",1),N.each(function(t){i(this).delay(t*q/N.length).animate({opacity:1},q/3,function(){t==N.length-1&&B()})})}else if("box2"==o){var q=h.duration*h.boxEffectDurationFactor,N=w.find(".pisonSlider_imgbox").css("opacity",0);w.css("opacity",1),g.delay(q/2).animate({opacity:0},2*q/3,function(){i(this).remove()}),N.each(function(t){i(this).delay((Math.floor(t/_)+t%_)*q/(_+C-1)).animate({opacity:1},q/2,function(){t==N.length-1&&B()})})}else if("box3"==o){var q=h.duration*h.boxEffectDurationFactor,N=w.find(".pisonSlider_imgbox").css("opacity",0);w.css("opacity",1),N.each(function(t){var e=Math.floor(Math.random()*N.length);return t==e||void N.eq(e).before(i(this))}),N=w.find(".pisonSlider_imgbox"),N.each(function(t){i(this).delay(t*q/N.length).animate({opacity:1},q/2,function(){t==N.length-1&&B()})})}else w.css("opacity",1),B()},prevPage:function(){this.pageChange(this.nowPage-1)},nextPage:function(){this.pageChange(this.nowPage+1)},cacheImage:function(t){var n=new Image;n.src=o.find("li:eq("+t+")").data("origin"),n.complete;var a=function(t){if(i.isFunction(t)){n.loadedCBRun=t,n.loadedCBRun(n.width,n.height);try{delete n.loadedCBRun}catch(e){}}n.originalSize={width:n.width,height:n.height}};n.loadedCB=function(i){n.complete?a(i):n.onload=function(){a(i)}},n.cssPosition=function(){var i={};if("widthfit"==h.mode||"stretch"==h.mode){if(i.width=e.width,i.height=i.width*this.height/this.width,i.left=0,i.top=0,e.height){var t=s.width()*this.height/this.width;t>e.height&&(i.height=e.height,i.width=e.height*this.width/this.height,i.left=(s.width()-i.width)/2)}if("stretch"==h.mode){i.top=0;var t=e.height;"100%"==i.width&&(t=s.width()*this.height/this.width),i.top=(s.height()-t)/2}}else if("filled"==h.mode||"zoomin"==h.mode){var n=this.width/this.height;n>e.width/e.height?(i.height=e.height,i.width=n*i.height,i.left=(e.width-i.width)/2,i.top=0):(i.width=e.width,i.height=i.width/n,i.top=(e.height-i.height)/2,i.left=0)}else i.width="100%";return i.top&&0!=i.top&&(i.top=Math.floor(i.top)),i.left&&0!=i.left&&(i.left=Math.floor(i.left)),i.height&&!isNaN(i.height)&&(i.height=Math.ceil(i.height)),i.width&&!isNaN(i.width)&&(i.width=Math.ceil(i.width)),i},m[t]=n},slideChange:function(t){if(i.isFunction(h.beforeSlideChange)&&h.beforeSlideChange(this.nowSlide,t),(this.nowPage*this.numThumbs>t||t>=(this.nowPage+1)*this.numThumbs)&&this.pageChange(parseInt(t/this.numThumbs),!1),t>=o.find("li").length)return void this.slideChange(0);o.find("li.current").removeClass("current"),o.find("li:eq("+t+")").addClass("current"),"undefined"!=typeof m[t]&&0!=m[t].width||this.cacheImage(t);var n=i(m[t]);n[0].loadedCB(function(i,e){h.SlideTransition(t,h.SlideLoaded)}),0!=h.width||"left"!=e.thumbPosition&&"right"!=e.thumbPosition||d.width(h.fullWidth()-s.fullWidth()),this.nowSlide=t,s.find("a.pisonSlider-canvas-anchor").remove(),"link_blank"==h.clickAction&&o.find("li:eq("+t+")").data("ps_href")&&s.find("div.pisonSlider-canvas-clickarea").append('<a href="'+o.find("li:eq("+t+")").data("ps_href")+'" target="_blank" class="pisonSlider-canvas-anchor" />'),h.indicator&&(s.find("div.pisonSlider-canvas-indicator.active").removeClass("active"),s.find("div.pisonSlider-canvas-indicator:eq("+t+")").addClass("active")),h.autoSlide&&s.find("div.pisonSlider-canvas-autoSlideBar").stop().css("width","0%").animate({width:"100%"},h.autoSlideTimer,"linear",function(){h.nextSlide()}),"undefined"==typeof m[t+1]&&t+1<o.find("li").length&&this.cacheImage(t+1)},ErrMsg:function(i){h.append('<div class="pisonSlider-ErrorMsg">pisonSlider: '+i+"</div>")}}),"stretch"==h.mode&&h.height<=0?(h.ErrMsg("Stretch mode required height"),h.mode="widthfit"):"filled"!=h.mode||h.height&&h.width?"zoomin"!=h.mode||h.height&&h.width||(h.ErrMsg("Zoomin mode required height and width"),h.mode="widthfit"):(h.ErrMsg("Filled mode required height and width"),h.mode="widthfit");var p=!1;if(h.width>0&&s.width(h.width),"widthfit"==h.mode?p=!0:"stretch"!=h.mode&&"filled"!=h.mode&&"zoomin"!=h.mode||s.height(h.height),o.find("li").each(function(t){i(this).data("index",t);var e=i(this).find("img");"undefined"==typeof i(this).data("thumb")&&"undefined"!=typeof e.data("thumb")&&i(this).data("thumb",e.data("thumb")),"undefined"!=typeof i(this).data("thumb")&&e.attr("src",i(this).data("thumb")),i(this).find("a img").length>0&&(i(this).data("ps_href",i(this).find("a img").parent().attr("href")),i(this).find("a img").unwrap()),a&&h.thumbHeight>0&&e[0].height>0?h.thumbWidth/h.thumbHeight<e[0].width/e[0].height?e.css({"margin-left":(h.thumbWidth-e[0].width/e[0].height*h.thumbHeight)/2,height:h.thumbHeight}):e.css({"margin-top":(h.thumbHeight-e[0].height/e[0].width*h.thumbWidth)/2,width:h.thumbWidth}):i(this).css("background-image","url('"+e.attr("src")+"')").empty(),h.useThumbSize&&i(this).css({width:h.thumbWidth,height:h.thumbHeight}),i(this).bind(h.thumbSlideEvent,function(){h.slideChange(t)})}),u.click(function(){h.prevPage()}),g.click(function(){h.nextPage()}),s.find("div.pisonSlider-canvas-clickarea").mousedown(function(i){return"pisonSlider-canvas-clickarea"!=i.target.className?(i.stopPropagation(),!1):void(i.button>1||"link_blank"==h.clickAction&&"undefined"!=typeof m[h.nowSlide].ps_href||h.nextSlide())}),"zoomin"==h.mode&&h.zoominMouseOverStop&&s.find("div.pisonSlider-canvas-clickarea").hover(function(){f=!0},function(){f=!1}),h.indicator){for(var v='<div class="pisonSlider-canvas-indicatorWrap">',w=0;w<h.totalSlideCnt;w++)v+='<div class="pisonSlider-canvas-indicator" data-index="'+w+'" />';v+="</div>",v=i(v),s.find("div.pisonSlider-canvas-clickarea").append(v),v.find("div.pisonSlider-canvas-indicator").click(function(){h.slideChange(i(this).data("index")),e.onHoverStop&&s.find("div.pisonSlider-canvas-autoSlideBar").stop()})}if(h.autoSlide){var S='<div class="pisonSlider-canvas-autoSlideBar'+("top"==h.autoSlideBarPosition?" pisonSlider-canvas-autoSlideBar-top":"")+'" />';s.find("div.pisonSlider-canvas-clickarea").append(S),e.onHoverStop&&s.hover(function(){s.find("div.pisonSlider-canvas-autoSlideBar").stop()},function(){var t=(1-s.find("div.pisonSlider-canvas-autoSlideBar").width()/i(this).width())*h.autoSlideTimer;s.find("div.pisonSlider-canvas-autoSlideBar").animate({width:"100%"},t,"linear",function(){h.nextSlide()})})}return h.pageChange(0),h.slideChange(e.startSlideIndex),h}})}(jQuery);