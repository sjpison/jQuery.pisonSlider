/**
 * pisonSlider
 *
 * jQuery Gallery plugin
 * @version 0.3.0
 *
 * copyright (c) 2008 Pison, Seol Dong-jin <www.codemission.org>
 * It need jQuery 1.8+
 */
Array.prototype.indexOf||(Array.prototype.indexOf=function(i){var t=this.length>>>0,e=Number(arguments[1])||0;for(e=e<0?Math.ceil(e):Math.floor(e),e<0&&(e+=t);e<t;e++)if(e in this&&this[e]===i)return e;return-1}),function(i){i.fn.extend({pisonSlider:function(t){if(!this.is("ul")&&!this.is("ol")||0==this.find("li").length)return!1;var e="pisonSlider";this.addClass(e+"-list");var a={startSlideIndex:0,mode:"contain",zoomin:!1,zoominMouseOverStop:!0,thumbPosition:"none",useThumbPage:!0,numThumbs:7,useThumbSize:!1,thumbWidth:75,thumbHeight:75,boxWidth:70,boxHeight:70,width:"100%",height:null,ratio:16/9,autoSlide:!1,autoSlideTimer:5e3,autoSlideBar:!0,autoSlideBarPosition:"bottom",onHoverStop:!0,indicator:!1,effect:"random",duration:400,hDuration:0,boxEffectDurationFactor:2,thumbSlideEvent:"click",SlideLoaded:null,beforeSlideChange:null,clickAction:"link_blank"};i.extend(a,t),this.find("li").each(function(){var t=i(this).find("img");"undefined"==typeof i(this).data("origin")&&i(this).data("origin",t.attr("src")),"undefined"==typeof i(this).data("thumb")&&"undefined"==typeof t.data("thumb")||t.removeAttr("src")});var n=null!=navigator.userAgent.match(/MSIE/i),h=n&&navigator.userAgent.match(/MSIE (\d)/i)[1]<9&&navigator.userAgent.match(/MSIE (\d)/i)[1]>4;this.find("li").length<=1&&(a.autoSlide=!1,a.indicator=!1);var o=this.wrap('<div class="pisonSlider'+(h?" underIE8":"")+(n?" isIE":"")+'"><div class="pisonSlider-thumbs pisonSlider-thumbs-'+a.thumbPosition+(a.useThumbPage?"":" pisonSlider-thumbs-nopage")+'" /></div>').parent().parent(),d=o.find("div.pisonSlider-thumbs"),s=this,r=i('<div class="pisonSlider-canvas pisonSlider-thumbs-'+a.thumbPosition+'"><div class="pisonSlider-canvas-clickarea"></div></div>'),l={},c=null,f=null,u=!1;0==o.width||"left"!=a.thumbPosition&&"right"!=a.thumbPosition||d.width(o.width()-a.width),"left"==a.thumbPosition||"bottom"==a.thumbPosition||"right"==a.thumbPosition?o.prepend(r):o.append(r);var g=i('<div class="pagearrow thumbs_left_arrow"></div>');d.prepend(g);var p=i('<div class="pagearrow thumbs_right_arrow"></div>');d.append(p);var v={};l.effect_box=["box1","box2","box3"],l.effect_normal=["fade","coverLeft","coverRight"],l.effect_list=l.effect_box.concat(l.effect_normal),l.pixelFixing=function(t){var e=t.data("vertical-count"),a=t.data("horizontal-count"),n=t.data("box-width-percent"),h=t.data("box-height-percent");t.find(".pisonSlider-imgbox").each(function(){var t=i(this);if(t.data("x")>0){var o=t.siblings("[data-x="+(t.data("x")-1)+"][data-y="+t.data("y")+"]");if(Math.round(o.width()+o.position().left)!=Math.round(t.position().left)){var d=t.data("x")-1;o.css("width","calc("+n+"% + 1px)"),o.find(">div").css({width:"calc("+100*a+"% - "+1*a+"px)",left:"calc(-"+100*d+"% + "+1*d+"px)"})}}if(t.data("y")>0){var o=t.siblings("[data-y="+(t.data("y")-1)+"][data-x="+t.data("x")+"]");if(Math.round(o.height()+o.position().top)!=Math.round(t.position().top)){var s=t.data("y")-1;o.css("height","calc("+h+"% + 1px)"),o.find(">div").css({height:"calc("+100*e+"% - "+1*e+"px)",top:"calc(-"+100*s+"% + "+1*s+"px)"})}}})},i.extend(o,{nowPage:0,nowSlide:0,totalSlideCnt:s.find("li").length,prevSlide:function(){this.nowSlide-1<0?this.slideChange(this.totalSlideCnt-1):this.slideChange(this.nowSlide-1)},nextSlide:function(){o.find("li").length<=1||this.slideChange(this.nowSlide+1)},pageChange:function(t,e){"undefined"==typeof e?e=!0:"";var a=this.numThumbs*t,n=this.numThumbs*(t+1)-1,h=!1;s.find("li").each(function(t,e){t>=a&&t<=n?i(this).removeClass("unvisible"):(o.useThumbPage&&i(this).addClass("unvisible"),i(this).is("li.current")&&(h=!0))}),h&&e&&this.slideChange(a),this.nowPage=t,o.useThumbPage?(0==this.nowPage?g.hide():g.show(),n>=s.find("li").length-1?p.hide():p.show()):(g.hide(),p.hide())},NowSlideTransitioningCount:0,SlideTransition:function(t,n){var d=++o.NowSlideTransitioningCount,s=a.effect;"random"==s?s=l.effect_list[Math.floor(Math.random()*l.effect_list.length)]:"box_random"==s?s=l.effect_box[Math.floor(Math.random()*l.effect_box.length)]:"normal_random"==s&&(s=l.effect_normal[Math.floor(Math.random()*l.effect_normal.length)]);var g=i(v[t]),p=(v[t],r.find("div.pisonSlider-img-wrap:last").stop(!0,!0).addClass("pisonSlider-preimg-wrap")),m=p.find("img"),b=i('<div class="pisonSlider-img-wrap" data-transition_effect="'+s+'" />').appendTo(r),w=g[0].cssPosition(),S=new Array,x="100",y="100",C=1,P=1,_=o.data(e+"-canvas-width"),M=w.height;"auto"!=a.height&&(M=o.data(e+"-canvas-height"),"%"==M.charAt(M.length-1)&&(M=_*M.substr(0,M.length-1)/100));var k={width:_,height:M};l.effect_box.indexOf(s)>=0&&(C=Math.round(_/a.boxWidth),P=Math.round(M/a.boxHeight),x/=C,y/=P,k.width=a.boxWidth+10,k.height=a.boxHeight+10),b.data("vertical-count",P),b.data("horizontal-count",C),b.data("box-width-percent",x),b.data("box-height-percent",y);for(var T="",I=0;I<P;I++)for(var B=0;B<C;B++)T+='<div class="'+e+'-imgbox" data-x="'+B+'" data-y="'+I+'" style="width:'+x+"%;height:"+y+"%;left:"+x*B+"%;top:"+y*I+'%;">',T+=h?'<img src="'+g.attr("src")+'" style="width:'+w.width+"px;height:"+w.height+"px;margin-top:"+(y*I*-1+w.top)+"px;margin-left:"+(x*B*-1+w.left)+'px;" />':a.zoomin?'<canvas width="'+k.width+'" height="'+k.height+'" />':"<div style=\"background-image:url('"+g.attr("src")+"');width:"+100*C+"%;height:"+100*P+"%;left:-"+B+"00%;top:-"+I+'00%;" />',T+="</div>";if(b.append(T),a.zoomin&&b.find("canvas").each(function(t){S[t]={ctx:this.getContext("2d"),x:i(this).parent().data("x"),y:i(this).parent().data("y")},S[t].ctx.drawImage(g[0],w.left-_/C*S[t].x,w.top-M/P*S[t].y,w.width,w.height)}),"auto"==a.height&&r.height()!=w.height){p.css("height",p.height());var z=w.height>m.height()?w.height:m.height();!o.hDuration||g.is(".pisonSlider_preimg")?r.height(z):o.hDuration&&r.animate({height:z},o.hDuration)}l.pixelFixing(b);var H=function(){p.remove(),d==o.NowSlideTransitioningCount&&(r.find(".pisonSlider-preimg-wrap").remove(),"auto"==a.height&&r.height()!=w.height&&(o.hDuration?r.animate({height:w.height},o.hDuration):r.height(w.height)),clearInterval(f),i.isFunction(n)&&(o.SlideTransitionCallback=n,o.SlideTransitionCallback(t)))};if(a.zoomin){clearInterval(f),f=c;var A=1.0006,W={width:w.width,height:w.height,top:0,left:0};c=setInterval(function(){if(!u){var i=W.width,t=W.height;W.width*=A,W.height*=A,W.top+=(t-W.height)/2,W.left+=(i-W.width)/2;for(var e in S)S[e].ctx.drawImage(g[0],W.left+w.left-_/C*S[e].x,W.top+w.top-M/P*S[e].y,W.width,W.height);W.width>1.3*w.width&&clearInterval(c)}},40)}if(b.data("effect_type",s),"fade"==s)b.css("opacity",1).find(".pisonSlider-imgbox").css("opacity",0).animate({opacity:1},a.duration,function(){0==p.length&&H()}),p.find(".pisonSlider-imgbox").delay(a.duration/2).animate({opacity:0},a.duration/2,function(){H()});else if("coverLeft"==s||"coverRight"==s){var E=a.width>0?a.width:r.width();a.height>0?a.height:g[0].height;b.css({left:"coverLeft"==o.effect?r.width():-E,top:0,opacity:1,"z-index":2}).animate({left:0},a.duration,function(){0==p.length&&H()}),p.delay(a.duration/2).animate({opacity:0},a.duration/2,function(){H()})}else if("box1"==s){var D=a.duration*a.boxEffectDurationFactor,F=b.find(".pisonSlider-imgbox").css("opacity",0);b.css("opacity",1),F.each(function(t){i(this).delay(t*D/F.length).animate({opacity:1},D/3,function(){t==F.length-1&&H()})})}else if("box2"==s){var D=a.duration*a.boxEffectDurationFactor,F=b.find(".pisonSlider-imgbox").css("opacity",0);b.css("opacity",1),p.delay(D/2).animate({opacity:0},2*D/3,function(){i(this).remove()}),F.each(function(t){i(this).delay((Math.floor(t/C)+t%C)*D/(C+P-1)).animate({opacity:1},D/2,function(){t==F.length-1&&H()})})}else if("box3"==s){var D=a.duration*a.boxEffectDurationFactor,F=b.find(".pisonSlider-imgbox").css("opacity",0);b.css("opacity",1),F.each(function(t){var e=Math.floor(Math.random()*F.length);return t==e||void F.eq(e).before(i(this))}),F=b.find(".pisonSlider-imgbox"),F.each(function(t){i(this).delay(t*D/F.length).animate({opacity:1},D/2,function(){t==F.length-1&&H()})})}else b.css("opacity",1),H()},prevPage:function(){this.pageChange(this.nowPage-1)},nextPage:function(){this.pageChange(this.nowPage+1)},cacheImage:function(t){var n=new Image;n.src=s.find("li:eq("+t+")").data("origin"),n.complete;var h=function(t){if(i.isFunction(t)){n.loadedCBRun=t,n.loadedCBRun(n.width,n.height);try{delete n.loadedCBRun}catch(e){}}n.originalSize={width:n.width,height:n.height}};n.loadedCB=function(i){n.complete?h(i):n.onload=function(){h(i)}},n.cssPosition=function(){var i={width:o.data(e+"-canvas-width"),height:o.data(e+"-canvas-height"),top:0,left:0};"%"==i.height.charAt(i.height.length-1)&&(i.height=i.width*i.height.substr(0,i.height.length-1)/100);var t={width:i.width,height:i.height},n=this.width/this.height;if("auto"==a.height)i.height=i.width/n;else if("contain"==a.mode){var h=t.width/t.height;h>n?(i.width=t.height*n,i.left=(t.width-i.width)/2):(i.height=t.width/n,i.top=(t.height-i.height)/2)}else{var h=t.width/t.height;h>n?(i.height=t.width/n,i.top=(t.height-i.height)/2):(i.width=t.height*n,i.left=(t.width-i.width)/2)}return i.top=Math.floor(i.top),i.left=Math.floor(i.left),i.height=Math.ceil(i.height),i.width=Math.ceil(i.width),i},v[t]=n},slideChange:function(t){if(i.isFunction(o.beforeSlideChange)&&o.beforeSlideChange(this.nowSlide,t),(this.nowPage*this.numThumbs>t||t>=(this.nowPage+1)*this.numThumbs)&&this.pageChange(parseInt(t/this.numThumbs),!1),t>=s.find("li").length)return void this.slideChange(0);s.find("li.current").removeClass("current"),s.find("li:eq("+t+")").addClass("current"),"undefined"!=typeof v[t]&&0!=v[t].width||this.cacheImage(t);var e=i(v[t]);e[0].loadedCB(function(i,e){o.SlideTransition(t,o.SlideLoaded)}),0!=o.width||"left"!=a.thumbPosition&&"right"!=a.thumbPosition||d.width(o.fullWidth()-r.fullWidth()),this.nowSlide=t,r.find("a.pisonSlider-canvas-anchor").remove(),"link_blank"==o.clickAction&&s.find("li:eq("+t+")").data("ps_href")&&r.find("div.pisonSlider-canvas-clickarea").append('<a href="'+s.find("li:eq("+t+")").data("ps_href")+'" target="_blank" class="pisonSlider-canvas-anchor" />'),o.indicator&&(r.find("div.pisonSlider-canvas-indicator.active").removeClass("active"),r.find("div.pisonSlider-canvas-indicator:eq("+t+")").addClass("active")),o.autoSlide&&r.find("div.pisonSlider-canvas-autoSlideBar").stop().css("width","0%").animate({width:"100%"},o.autoSlideTimer,"linear",function(){o.nextSlide()}),"undefined"==typeof v[t+1]&&t+1<s.find("li").length&&this.cacheImage(t+1)}}),o.addClass(e+"-mode-"+a.mode),"100%"!=a.width&&r.width(a.width);var m=r.width();o.data(e+"-canvas-width",m);var b=null;if("auto"==a.height?(o.addClass(e+"-autoHeight"),a.height="auto",b=0):null==a.height?(b=100/a.ratio+"%",r.css("padding-top",b)):(b=a.height,r.css("padding-top",b)),o.data(e+"-canvas-height",b),s.find("li").each(function(t){i(this).data("index",t);var e=i(this).find("img");"undefined"==typeof i(this).data("thumb")&&"undefined"!=typeof e.data("thumb")&&i(this).data("thumb",e.data("thumb")),"undefined"!=typeof i(this).data("thumb")&&e.attr("src",i(this).data("thumb")),i(this).find("a img").length>0&&(i(this).data("ps_href",i(this).find("a img").parent().attr("href")),i(this).find("a img").unwrap()),h&&o.thumbHeight>0&&e[0].height>0?o.thumbWidth/o.thumbHeight<e[0].width/e[0].height?e.css({"margin-left":(o.thumbWidth-e[0].width/e[0].height*o.thumbHeight)/2,height:o.thumbHeight}):e.css({"margin-top":(o.thumbHeight-e[0].height/e[0].width*o.thumbWidth)/2,width:o.thumbWidth}):i(this).css("background-image","url('"+e.attr("src")+"')").empty(),o.useThumbSize&&i(this).css({width:o.thumbWidth,height:o.thumbHeight}),i(this).bind(o.thumbSlideEvent,function(){o.slideChange(t)})}),g.click(function(){o.prevPage()}),p.click(function(){o.nextPage()}),r.find("div.pisonSlider-canvas-clickarea").mousedown(function(i){return"pisonSlider-canvas-clickarea"!=i.target.className?(i.stopPropagation(),!1):void(i.button>1||"link_blank"==o.clickAction&&"undefined"!=typeof v[o.nowSlide].ps_href||o.nextSlide())}),a.zoomin&&a.zoominMouseOverStop&&r.find("div.pisonSlider-canvas-clickarea").hover(function(){u=!0},function(){u=!1}),o.indicator){for(var w='<div class="pisonSlider-canvas-indicatorWrap">',S=0;S<o.totalSlideCnt;S++)w+='<div class="pisonSlider-canvas-indicator" data-index="'+S+'" />';w+="</div>",w=i(w),r.find("div.pisonSlider-canvas-clickarea").append(w),w.find("div.pisonSlider-canvas-indicator").click(function(){o.slideChange(i(this).data("index")),a.onHoverStop&&r.find("div.pisonSlider-canvas-autoSlideBar").stop()})}if(o.autoSlide){var x='<div class="pisonSlider-canvas-autoSlideBar'+("top"==o.autoSlideBarPosition?" pisonSlider-canvas-autoSlideBar-top":"")+'" />';r.find("div.pisonSlider-canvas-clickarea").append(x),a.onHoverStop&&r.hover(function(){r.find("div.pisonSlider-canvas-autoSlideBar").stop()},function(){var t=(1-r.find("div.pisonSlider-canvas-autoSlideBar").width()/i(this).width())*o.autoSlideTimer;r.find("div.pisonSlider-canvas-autoSlideBar").animate({width:"100%"},t,"linear",function(){o.nextSlide()})})}return o.pageChange(0),o.slideChange(a.startSlideIndex),isNaN(a.width)&&i(window).bind("resize."+e,function(){l.pixelFixing(r.find("div.pisonSlider-img-wrap:last"))}),o}})}(jQuery);